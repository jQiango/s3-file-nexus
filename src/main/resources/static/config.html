<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3 文件管理器 - 配置</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/manifest.json">

    <!-- Bootstrap Icons - jsDelivr (主CDN) with Unpkg fallback -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
          onerror="this.onerror=null;this.href='https://unpkg.com/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css'">

    <!-- Tailwind CSS (Official CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [v-cloak] {
            display: none !important;
        }

        @keyframes slide-in-right {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .animate-slide-in-right {
            animation: slide-in-right 0.3s ease-out;
        }

        @keyframes slide-up {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .animate-slide-up {
            animation: slide-up 0.3s ease-out;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .animate-fade-in {
            animation: fade-in 0.4s ease-out;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }

        .history-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .history-card:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        /* 统一按钮动效系统 */
        button, .button {
            position: relative;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 禁用按钮样式 */
        button:disabled {
            cursor: not-allowed;
            opacity: 0.4;
        }

        /* 主要按钮（蓝色/渐变背景）hover效果 */
        button:not(:disabled)[class*="bg-blue"]:hover,
        button:not(:disabled)[class*="bg-gradient"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }

        button:not(:disabled)[class*="bg-blue"]:active,
        button:not(:disabled)[class*="bg-gradient"]:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.2);
        }

        /* 次要按钮（灰色背景）hover效果 */
        button:not(:disabled)[class*="bg-gray"]:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        button:not(:disabled)[class*="bg-gray"]:active {
            transform: scale(0.98);
        }

        /* 危险按钮（红色）hover效果 */
        button:not(:disabled)[class*="bg-red"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(220, 38, 38, 0.3);
        }

        button:not(:disabled)[class*="bg-red"]:active {
            transform: translateY(0);
        }

        /* 小按钮hover效果 */
        button[class*="text-xs"]:not(:disabled):hover {
            transform: scale(1.05);
        }

        /* 图标动画 */
        button:hover .bi-arrow-clockwise {
            animation: spin 0.6s linear;
        }

        button:hover .bi-trash {
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px) rotate(-5deg); }
            75% { transform: translateX(2px) rotate(5deg); }
        }

        button:hover .bi-eye,
        button:hover .bi-eye-slash {
            animation: blink 0.5s ease;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        button:hover .bi-box-arrow-in-right {
            animation: slideRight 0.3s ease;
        }

        @keyframes slideRight {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(3px); }
        }

        button:hover .bi-x-lg,
        button:hover .bi-x {
            transform: rotate(90deg);
            transition: transform 0.2s ease;
        }

        button:hover .bi-check-circle {
            animation: checkPulse 0.3s ease;
        }

        @keyframes checkPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Toast动效增强 */
        .toast-enter {
            animation: slide-in-right 0.3s ease-out;
        }

        /* 输入框焦点效果 */
        input:focus {
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="h-full overflow-auto bg-gradient-to-br from-gray-50 via-white to-gray-50">
    <div id="app" v-cloak class="min-h-screen py-12 px-4 relative">
        <!-- 加载提示（右下角） -->
        <div v-if="loading" class="fixed bottom-6 right-6 z-50 bg-white rounded-xl shadow-2xl border border-gray-200 p-4 animate-slide-up max-w-xs">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0">
                    <i class="bi bi-arrow-clockwise text-white text-lg animate-spin"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-900 truncate">{{ loadingMessage }}</p>
                    <p class="text-xs text-gray-600 mt-0.5">请稍候...</p>
                </div>
            </div>
        </div>

        <!-- 主容器 -->
        <div class="max-w-xl mx-auto">
            <!-- Logo和标题 -->
            <div class="text-center mb-6 animate-fade-in">
                <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 shadow-lg mb-3">
                    <i class="bi bi-cloud-fill text-white text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-1">S3 文件管理器</h1>
                <p class="text-sm text-gray-600">配置您的对象存储连接</p>
            </div>

            <!-- Toast 通知 -->
            <div v-if="alert.show"
                 class="mb-6 p-4 rounded-xl border-2 flex items-start gap-3 animate-slide-in-right"
                 :class="{
                     'bg-green-50 border-green-200': alert.type === 'success',
                     'bg-red-50 border-red-200': alert.type === 'error'
                 }">
                <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0"
                     :class="{
                         'bg-green-100': alert.type === 'success',
                         'bg-red-100': alert.type === 'error'
                     }">
                    <i class="text-xl"
                       :class="{
                           'bi bi-check-circle text-green-600': alert.type === 'success',
                           'bi bi-x-circle text-red-600': alert.type === 'error'
                       }"></i>
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-sm mb-1"
                        :class="{
                            'text-green-900': alert.type === 'success',
                            'text-red-900': alert.type === 'error'
                        }">
                        {{ alert.type === 'success' ? '操作成功' : '操作失败' }}
                    </h4>
                    <p class="text-xs"
                       :class="{
                           'text-green-800': alert.type === 'success',
                           'text-red-800': alert.type === 'error'
                       }">{{ alert.message }}</p>
                </div>
                <button @click="alert.show = false" class="text-gray-500 hover:text-gray-700">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <!-- 配置表单卡片 -->
            <div class="bg-white rounded-2xl shadow-xl border border-gray-200 p-6 mb-6 animate-slide-up">
                <form @submit.prevent="saveConfig">
                    <!-- Endpoint -->
                    <div class="mb-5">
                        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-link-45deg text-blue-600 text-base"></i>
                            服务端点 (Endpoint) <span class="text-red-500">*</span>
                        </label>
                        <input
                            v-model="config.endpoint"
                            type="text"
                            placeholder="https://s3.amazonaws.com"
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all"
                            required>
                        <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                            <i class="bi bi-info-circle"></i>
                            示例: http://minio:9000
                        </p>
                    </div>

                    <!-- Access Key -->
                    <div class="mb-5">
                        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-key-fill text-blue-600 text-base"></i>
                            Access Key ID <span class="text-red-500">*</span>
                        </label>
                        <input
                            v-model="config.accessKey"
                            type="text"
                            placeholder="输入您的 Access Key ID"
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none font-mono transition-all"
                            required>
                    </div>

                    <!-- Secret Key -->
                    <div class="mb-5">
                        <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                            <i class="bi bi-shield-lock-fill text-blue-600 text-base"></i>
                            Secret Access Key <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input
                                v-model="config.secretKey"
                                :type="showSecret ? 'text' : 'password'"
                                placeholder="输入您的 Secret Access Key"
                                class="w-full px-4 py-3 pr-12 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none font-mono transition-all"
                                required>
                            <button
                                type="button"
                                @click="showSecret = !showSecret"
                                class="absolute right-3 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-all">
                                <i :class="showSecret ? 'bi-eye-slash' : 'bi-eye'"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Region 和 Bucket 并排 -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <!-- Region -->
                        <div>
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-globe2 text-blue-600 text-base"></i>
                                区域
                            </label>
                            <input
                                v-model="config.region"
                                type="text"
                                placeholder="ap-beijing"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all">
                        </div>

                        <!-- Default Bucket -->
                        <div>
                            <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                <i class="bi bi-database text-blue-600 text-base"></i>
                                存储桶
                            </label>
                            <input
                                v-model="config.bucket"
                                type="text"
                                placeholder="my-bucket"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all">
                        </div>
                    </div>

                    <!-- 按钮组 -->
                    <div class="flex gap-3">
                        <button
                            type="button"
                            @click="testConnection"
                            :disabled="testing"
                            class="flex-1 flex items-center justify-center gap-2 px-5 py-3 bg-gray-100 text-gray-700 rounded-xl text-sm font-medium hover:bg-gray-200 disabled:opacity-40 disabled:cursor-not-allowed transition-all">
                            <i :class="testing ? 'bi-arrow-clockwise animate-spin' : 'bi-wifi'"></i>
                            <span>{{ testing ? '测试中...' : '测试连接' }}</span>
                        </button>
                        <button
                            type="submit"
                            :disabled="saving"
                            class="flex-1 flex items-center justify-center gap-2 px-5 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl text-sm font-medium hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/20 disabled:opacity-40 disabled:cursor-not-allowed transition-all">
                            <i :class="saving ? 'bi-arrow-clockwise animate-spin' : 'bi-check-circle'"></i>
                            <span>{{ saving ? '保存中...' : '保存并进入' }}</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- 历史配置 -->
            <div v-if="savedConfigs.length > 0" class="bg-white rounded-2xl shadow-xl border border-gray-200 p-6 mb-6 animate-slide-up">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-base font-bold text-gray-900 flex items-center gap-2">
                        <i class="bi bi-clock-history text-blue-600"></i>
                        最近使用的配置
                    </h3>
                    <span class="text-xs font-medium text-gray-500 px-2.5 py-1 bg-gray-100 rounded-full">{{ savedConfigs.length }} 个</span>
                </div>

                <div class="space-y-3">
                    <div
                        v-for="(item, index) in savedConfigs"
                        :key="index"
                        class="history-card flex items-center gap-4 px-4 py-3 border border-gray-200 rounded-xl hover:border-blue-300 cursor-pointer group bg-white hover:bg-gradient-to-r hover:from-blue-50/50 hover:to-transparent">
                        <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-md">
                            <i class="bi bi-server text-white text-lg"></i>
                        </div>
                        <div class="flex-1 min-w-0" @click="useConfig(index)">
                            <div class="font-semibold text-sm text-gray-900 truncate">{{ item.name }}</div>
                            <div class="text-xs text-gray-500 truncate mt-0.5">{{ item.endpoint }}</div>
                        </div>
                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-all">
                            <button
                                @click.stop="useConfig(index)"
                                class="px-3 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white text-xs font-medium rounded-lg hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/20 flex items-center gap-1.5">
                                <i class="bi bi-box-arrow-in-right"></i>
                                使用
                            </button>
                            <button
                                @click.stop="deleteConfig(index)"
                                class="px-2.5 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white text-xs font-medium rounded-lg hover:from-red-700 hover:to-red-800 shadow-lg shadow-red-500/20">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 安全提示 -->
            <div class="flex items-start gap-2 justify-center text-sm text-gray-500 animate-fade-in">
                <i class="bi bi-shield-check mt-0.5"></i>
                <p>配置信息仅保存在本地浏览器中，不会上传到服务器。请妥善保管您的密钥信息。</p>
            </div>
        </div>

        <!-- 删除确认对话框 -->
        <div v-if="showDeleteDialog" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50" @click.self="showDeleteDialog = false">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slide-up mx-4">
                <!-- 标题栏 -->
                <div class="flex items-center justify-between p-6">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-red-500 to-red-600 flex items-center justify-center shadow-lg shadow-red-500/30">
                            <i class="bi bi-exclamation-triangle text-white text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">确认删除</h3>
                            <p class="text-sm text-gray-500 mt-1">此操作不可恢复</p>
                        </div>
                    </div>
                </div>

                <!-- 内容区 -->
                <div class="px-6 pb-6">
                    <div class="flex items-center gap-3 px-4 py-3 bg-gray-50 rounded-xl border border-gray-200">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0">
                            <i class="bi bi-server text-white"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-gray-900 truncate">{{ configToDelete?.config?.name }}</p>
                            <p class="text-xs text-gray-500 mt-0.5 truncate">{{ configToDelete?.config?.endpoint }}</p>
                        </div>
                    </div>
                </div>

                <!-- 底部操作栏 -->
                <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-100 bg-gray-50">
                    <button @click="showDeleteDialog = false"
                            class="px-5 py-2.5 text-gray-700 hover:bg-white rounded-xl transition-all border border-transparent hover:border-gray-200">
                        取消
                    </button>
                    <button @click="confirmDelete"
                            class="px-6 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg shadow-red-500/20 flex items-center gap-2 font-medium">
                        <i class="bi bi-trash"></i>
                        <span>确认删除</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- GitHub 仓库标识 -->
        <a href="https://github.com/jQiango/s3-file-nexus"
           target="_blank"
           class="fixed top-6 right-6 z-50 inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gray-800 to-gray-900 text-white rounded-lg hover:from-gray-900 hover:to-black transition-all shadow-lg hover:shadow-xl group">
            <svg class="w-5 h-5 group-hover:scale-110 group-hover:rotate-12 transition-transform" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            <span class="font-semibold text-sm">s3-file-nexus</span>
            <i class="bi bi-box-arrow-up-right text-xs opacity-75 group-hover:opacity-100 group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-all"></i>
        </a>
    </div>

    <!-- Vue 3 - jsDelivr (主CDN) with Unpkg fallback -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.prod.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js'"></script>

    <script>
        const { createApp } = Vue;
        const STORAGE_KEY = 's3_configs';

        createApp({
            data() {
                return {
                    config: {
                        name: '',
                        endpoint: '',
                        accessKey: '',
                        secretKey: '',
                        region: 'ap-beijing',
                        bucket: ''
                    },
                    savedConfigs: [],
                    showSecret: false,
                    testing: false,
                    saving: false,
                    loading: false,
                    loadingMessage: '正在加载配置',
                    alert: {
                        show: false,
                        type: 'success',
                        message: ''
                    },
                    showDeleteDialog: false,
                    configToDelete: null
                };
            },
            mounted() {
                this.loadSavedConfigs();
            },
            methods: {
                loadSavedConfigs() {
                    const configs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                    this.savedConfigs = configs;
                },
                showAlert(message, type = 'success') {
                    this.alert = {
                        show: true,
                        type,
                        message
                    };
                    setTimeout(() => {
                        this.alert.show = false;
                    }, 5000);
                },
                async testConnection() {
                    // 验证必填字段
                    if (!this.config.endpoint || !this.config.accessKey || !this.config.secretKey) {
                        this.showAlert('请填写完整的连接信息（Endpoint、Access Key、Secret Key）', 'error');
                        return;
                    }

                    this.testing = true;
                    try {
                        const response = await fetch('/api/storage/config/test', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.config)
                        });

                        const result = await response.json();

                        if (result.success) {
                            this.showAlert('连接测试成功！可以正常访问存储服务。', 'success');
                        } else {
                            this.showAlert('连接测试失败: ' + (result.message || '未知错误'), 'error');
                        }
                    } catch (error) {
                        this.showAlert('连接测试失败: ' + error.message, 'error');
                    } finally {
                        this.testing = false;
                    }
                },
                async saveConfig() {
                    // 自动生成配置名称
                    if (!this.config.name) {
                        const now = new Date();
                        this.config.name = `配置-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                    }

                    // 验证必填字段
                    if (!this.config.endpoint || !this.config.accessKey || !this.config.secretKey) {
                        this.showAlert('请填写完整的配置信息（Endpoint、Access Key、Secret Key）', 'error');
                        return;
                    }

                    this.saving = true;
                    try {
                        const response = await fetch('/api/storage/config/update', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(this.config)
                        });

                        const result = await response.json();

                        if (result.success) {
                            // 保存到localStorage
                            const configs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                            const existingIndex = configs.findIndex(c => c.name === this.config.name);

                            if (existingIndex >= 0) {
                                configs[existingIndex] = { ...this.config };
                            } else {
                                configs.push({ ...this.config });
                                // 只保留最近10个配置
                                if (configs.length > 10) {
                                    configs.shift();
                                }
                            }

                            localStorage.setItem(STORAGE_KEY, JSON.stringify(configs));
                            sessionStorage.setItem('current_s3_config', JSON.stringify(this.config));

                            // 显示加载遮罩
                            this.loading = true;
                            this.loadingMessage = '配置保存成功，正在跳转';

                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 1000);
                        } else {
                            this.showAlert('配置保存失败: ' + (result.message || '未知错误'), 'error');
                        }
                    } catch (error) {
                        this.showAlert('配置保存失败: ' + error.message, 'error');
                    } finally {
                        this.saving = false;
                    }
                },
                async useConfig(index) {
                    const config = this.savedConfigs[index];
                    if (!config) return;

                    // 显示加载遮罩
                    this.loading = true;
                    this.loadingMessage = '正在加载配置';

                    try {
                        const response = await fetch('/api/storage/config/update', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(config)
                        });

                        const result = await response.json();

                        if (result.success) {
                            sessionStorage.setItem('current_s3_config', JSON.stringify(config));
                            this.loadingMessage = '配置加载成功，正在跳转';
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 800);
                        } else {
                            this.loading = false;
                            this.showAlert('加载配置失败: ' + (result.message || '未知错误'), 'error');
                        }
                    } catch (error) {
                        this.loading = false;
                        this.showAlert('加载配置失败: ' + error.message, 'error');
                    }
                },
                deleteConfig(index) {
                    const config = this.savedConfigs[index];
                    this.configToDelete = { index, config };
                    this.showDeleteDialog = true;
                },
                confirmDelete() {
                    if (this.configToDelete === null) return;

                    const configs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                    configs.splice(this.configToDelete.index, 1);
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(configs));
                    this.loadSavedConfigs();
                    this.showAlert('配置已删除', 'success');

                    this.showDeleteDialog = false;
                    this.configToDelete = null;
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
